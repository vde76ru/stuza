import{_ as C,g as _,p as j,o as z,a as s,c as l,m as x,b as r,t as v,q as k,s as B,F as I,l as w,r as p,u as E,d as P,w as L,e as N,x as O,n as T}from"./main-07a7457e.js";const V={name:"MatryoshkaCard",props:{product:{type:Object,required:!0}},setup(g){const e=_(null),o=_(null),t=_(null),u=_(0),i=_(0),c=_(!1),m=j(()=>{var a;return((a=g.product.gallery_images)==null?void 0:a[i.value])||""}),h=a=>{a.preventDefault();const y=a.deltaY,b=100;u.value+=y*.1,u.value=Math.max(0,Math.min(b,u.value)),d()},n=a=>{const y=a.target.scrollTop,b=a.target.scrollHeight-a.target.clientHeight;b>0&&(u.value=y/b*100,d())},d=()=>{const a=u.value/100;e.value&&(e.value.style.transform=`rotate(${-90*a}deg) scale(${1-a*.3})`),o.value&&(o.value.style.transform=`rotate(${-45*a}deg) scale(${1-a*.1})`),c.value=a>.5},f=()=>{i.value>0&&i.value--},M=()=>{i.value<g.product.gallery_images.length-1&&i.value++},S=a=>{a.target.src="/images/placeholder.jpg"};return z(()=>{d()}),{outerLayer:e,innerLayer:o,content:t,scrollProgress:u,currentImageIndex:i,currentImage:m,isOpen:c,onWheel:h,onScroll:n,previousImage:f,nextImage:M,handleImageError:S}}},W=["src","alt"],q=["src","alt"],F={key:0,class:"flex items-center justify-between"},H=["disabled"],D={class:"flex-1 text-center"},R=["src","alt"],U={class:"text-white text-sm mt-2"},Y=["disabled"],A={key:1,class:"text-center text-gray-400"},G={class:"absolute top-4 right-4 text-white text-sm bg-black/50 px-2 py-1 rounded"};function J(g,e,o,t,u,i){var c,m,h;return s(),l("div",{class:"matryoshka-container relative w-full h-96 overflow-hidden rounded-lg bg-gray-900 cursor-pointer",onScrollPassive:e[5]||(e[5]=(...n)=>t.onScroll&&t.onScroll(...n)),onWheel:e[6]||(e[6]=B((...n)=>t.onWheel&&t.onWheel(...n),["prevent"]))},[(c=o.product.image_layers)!=null&&c.outer?(s(),l("img",{key:0,src:o.product.image_layers.outer,alt:`${o.product.name} - внешний слой`,class:"outer layer absolute inset-0 w-full h-full object-cover transition-transform duration-500",ref:"outerLayer",onError:e[0]||(e[0]=(...n)=>t.handleImageError&&t.handleImageError(...n))},null,40,W)):x("",!0),(m=o.product.image_layers)!=null&&m.inner?(s(),l("img",{key:1,src:o.product.image_layers.inner,alt:`${o.product.name} - внутренний слой`,class:"inner layer absolute inset-0 w-full h-full object-cover transition-transform duration-500",ref:"innerLayer",onError:e[1]||(e[1]=(...n)=>t.handleImageError&&t.handleImageError(...n))},null,40,q)):x("",!0),r("div",{class:k(["inside-content absolute bottom-0 left-0 right-0 bg-black/80 p-4 transform translate-y-full transition-transform duration-500",{"translate-y-0":t.isOpen}]),ref:"content"},[((h=o.product.gallery_images)==null?void 0:h.length)>0?(s(),l("div",F,[r("button",{onClick:e[2]||(e[2]=(...n)=>t.previousImage&&t.previousImage(...n)),class:"text-white hover:text-stuzha-accent transition-colors p-2",disabled:t.currentImageIndex===0},e[7]||(e[7]=[r("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]),8,H),r("div",D,[r("img",{src:t.currentImage,alt:`${o.product.name} - изображение ${t.currentImageIndex+1}`,class:"gallery-img max-h-32 max-w-full object-contain mx-auto",onError:e[3]||(e[3]=(...n)=>t.handleImageError&&t.handleImageError(...n))},null,40,R),r("p",U,v(t.currentImageIndex+1)+" / "+v(o.product.gallery_images.length),1)]),r("button",{onClick:e[4]||(e[4]=(...n)=>t.nextImage&&t.nextImage(...n)),class:"text-white hover:text-stuzha-accent transition-colors p-2",disabled:t.currentImageIndex===o.product.gallery_images.length-1},e[8]||(e[8]=[r("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]),8,Y)])):(s(),l("div",A,e[9]||(e[9]=[r("p",null,"Дополнительные изображения отсутствуют",-1)])))],2),r("div",G,v(Math.round(t.scrollProgress))+"% ",1)],32)}const K=C(V,[["render",J]]),Q={name:"SimpleCard",props:{product:{type:Object,required:!0}},setup(g){const e=_(0),o=j(()=>{var c;return((c=g.product.gallery_images)==null?void 0:c[e.value])||"/images/placeholder.jpg"});return{currentImageIndex:e,currentImage:o,previousImage:()=>{e.value>0&&e.value--},nextImage:()=>{e.value<g.product.gallery_images.length-1&&e.value++},handleImageError:c=>{c.target.src="/images/placeholder.jpg"}}}},X={class:"simple-card bg-gray-900 rounded-lg overflow-hidden"},Z={class:"relative"},$={class:"aspect-w-1 aspect-h-1 bg-gray-800"},ee=["src","alt"],te={key:0,class:"absolute inset-0 flex items-center justify-between p-4"},re=["disabled"],oe=["disabled"],ne={key:1,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2"},se={class:"flex space-x-2"},le=["onClick"],ae={key:0,class:"p-4"},ie={class:"grid grid-cols-4 gap-2"},ce=["onClick"],de=["src","alt"];function ue(g,e,o,t,u,i){var c,m,h;return s(),l("div",X,[r("div",Z,[r("div",$,[r("img",{src:t.currentImage,alt:`${o.product.name} - изображение ${t.currentImageIndex+1}`,class:"w-full h-full object-cover",onError:e[0]||(e[0]=(...n)=>t.handleImageError&&t.handleImageError(...n))},null,40,ee)]),((c=o.product.gallery_images)==null?void 0:c.length)>1?(s(),l("div",te,[r("button",{onClick:e[1]||(e[1]=(...n)=>t.previousImage&&t.previousImage(...n)),class:"bg-black/50 text-white p-2 rounded-full hover:bg-black/70 transition-colors",disabled:t.currentImageIndex===0},e[4]||(e[4]=[r("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]),8,re),r("button",{onClick:e[2]||(e[2]=(...n)=>t.nextImage&&t.nextImage(...n)),class:"bg-black/50 text-white p-2 rounded-full hover:bg-black/70 transition-colors",disabled:t.currentImageIndex===o.product.gallery_images.length-1},e[5]||(e[5]=[r("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]),8,oe)])):x("",!0),((m=o.product.gallery_images)==null?void 0:m.length)>1?(s(),l("div",ne,[r("div",se,[(s(!0),l(I,null,w(o.product.gallery_images,(n,d)=>(s(),l("button",{key:d,onClick:f=>t.currentImageIndex=d,class:k(["w-2 h-2 rounded-full transition-colors",t.currentImageIndex===d?"bg-stuzha-accent":"bg-white/50"])},null,10,le))),128))])])):x("",!0)]),((h=o.product.gallery_images)==null?void 0:h.length)>1?(s(),l("div",ae,[r("div",ie,[(s(!0),l(I,null,w(o.product.gallery_images.slice(0,4),(n,d)=>(s(),l("button",{key:d,onClick:f=>t.currentImageIndex=d,class:k(["aspect-w-1 aspect-h-1 bg-gray-800 rounded overflow-hidden border-2 transition-colors",t.currentImageIndex===d?"border-stuzha-accent":"border-transparent"])},[r("img",{src:n,alt:`${o.product.name} - миниатюра ${d+1}`,class:"w-full h-full object-cover",onError:e[3]||(e[3]=(...f)=>t.handleImageError&&t.handleImageError(...f))},null,40,de)],10,ce))),128))])])):x("",!0)])}const ge=C(Q,[["render",ue]]),me={name:"Product",components:{MatryoshkaCard:K,SimpleCard:ge},setup(){const g=O(),e=_(!1),o=_(null),t=i=>new Intl.NumberFormat("ru-RU").format(i),u=async()=>{e.value=!0;try{const i=await T.get(`/product/${g.params.slug}`);o.value=i.data}catch(i){console.error("Ошибка загрузки товара:",i),o.value=null}finally{e.value=!1}};return z(()=>{u()}),{loading:e,product:o,formatPrice:t}}},he={class:"product min-h-screen bg-stuzha-bg py-20"},_e={class:"max-w-6xl mx-auto px-4"},ve={key:0,class:"flex justify-center items-center py-20"},xe={key:1,class:"grid grid-cols-1 lg:grid-cols-2 gap-12"},fe={class:"text-4xl font-bold text-white mb-4"},be={class:"text-3xl font-bold text-stuzha-accent mb-6"},ye={class:"prose prose-invert mb-8"},pe={class:"text-gray-300 text-lg leading-relaxed"},ke={class:"mb-8"},Ie={class:"space-y-2"},we={key:0,class:"flex items-center"},Ce={class:"text-white"},Ee={key:1,class:"flex items-start"},je={class:"flex flex-wrap gap-2"},ze={class:"mb-8"},Me=["href"],Se={key:2,class:"text-center py-20"};function Be(g,e,o,t,u,i){var n;const c=p("MatryoshkaCard"),m=p("SimpleCard"),h=p("router-link");return s(),l("div",he,[r("div",_e,[t.loading?(s(),l("div",ve,e[0]||(e[0]=[r("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-stuzha-accent"},null,-1)]))):t.product?(s(),l("div",xe,[r("div",null,[t.product.use_matryoshka?(s(),E(c,{key:0,product:t.product},null,8,["product"])):(s(),E(m,{key:1,product:t.product},null,8,["product"]))]),r("div",null,[r("h1",fe,v(t.product.name),1),r("div",be,v(t.formatPrice(t.product.price))+" ₽",1),r("div",ye,[r("p",pe,v(t.product.description),1)]),r("div",ke,[e[3]||(e[3]=r("h3",{class:"text-xl font-semibold text-white mb-4"},"Характеристики",-1)),r("div",Ie,[t.product.theme?(s(),l("div",we,[e[1]||(e[1]=r("span",{class:"text-gray-400 w-20"},"Тема:",-1)),r("span",Ce,v(t.product.theme),1)])):x("",!0),((n=t.product.attributes)==null?void 0:n.length)>0?(s(),l("div",Ee,[e[2]||(e[2]=r("span",{class:"text-gray-400 w-20"},"Камни:",-1)),r("div",je,[(s(!0),l(I,null,w(t.product.attributes,d=>(s(),l("span",{key:d,class:"bg-stuzha-accent/20 text-stuzha-accent px-3 py-1 rounded-full text-sm"},v(d),1))),128))])])):x("",!0)])]),r("div",ze,[r("a",{href:`https://t.me/stuzha_bot?start=order_${t.product.id}`,target:"_blank",class:"bg-stuzha-accent hover:bg-red-700 text-white px-8 py-4 rounded-lg text-lg font-semibold transition-all duration-300 transform hover:scale-105 inline-block"}," Заказать в Telegram ",8,Me)])])])):(s(),l("div",Se,[e[5]||(e[5]=r("h2",{class:"text-2xl font-bold text-white mb-4"},"Товар не найден",-1)),P(h,{to:"/catalog",class:"text-stuzha-accent hover:underline"},{default:L(()=>e[4]||(e[4]=[N(" Вернуться в каталог ")])),_:1,__:[4]})]))])])}const Le=C(me,[["render",Be]]);export{Le as default};
