import{g as j,p as z,i as B,a as r,c as a,F as N,l as T,b as e,m as b,s as Z,t as m,q as Y,n as P,_ as ee,h as te,j as _,v as U,A as ue,o as me,r as J,d as G,w as $,e as H,k as ce,z as X,u as ge,x as be,y as ye}from"./main-df5ed99e.js";const pe={class:"multi-image-picker"},fe={key:0,class:"grid grid-cols-4 gap-3 mb-4"},xe=["src"],ve={class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition flex items-center justify-center gap-2"},he=["onClick"],_e=["onClick"],we=["onClick"],ke={key:1,class:"text-gray-500 mb-4"},Ve={class:"bg-gray-800 rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col"},Ce={class:"mb-4 p-4 bg-gray-700 rounded"},Ae=["disabled"],Ue={key:0,class:"text-blue-400 mt-2"},je={class:"flex-1 overflow-y-auto"},Ie={class:"grid grid-cols-4 gap-3"},qe=["onClick"],Se=["src"],Pe={key:0,class:"absolute top-1 right-1 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm"},Me={class:"mt-4 pt-4 border-t border-gray-700 flex gap-3"},Ne=["disabled"],Te={__name:"MultiImagePicker",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(p,{emit:t}){const f=p,s=t,y=j(!1),C=j([]),g=j([]),I=j(!1),k=j(""),v=z({get:()=>f.modelValue,set:d=>s("update:modelValue",d)}),q=async()=>{try{const d=await P.get("/admin/images");C.value=d.data.data||d.data||[]}catch(d){console.error("Ошибка загрузки библиотеки:",d)}},o=d=>{const i=g.value.indexOf(d);i>-1?g.value.splice(i,1):g.value.push(d)},w=()=>{const d=[...v.value,...g.value];s("update:modelValue",d),h()},h=()=>{g.value=[],y.value=!1},S=d=>{const i=[...v.value];i.splice(d,1),s("update:modelValue",i)},O=d=>{if(d>0){const i=[...v.value];[i[d-1],i[d]]=[i[d],i[d-1]],s("update:modelValue",i)}},L=d=>{if(d<v.value.length-1){const i=[...v.value];[i[d],i[d+1]]=[i[d+1],i[d]],s("update:modelValue",i)}},R=async d=>{const i=Array.from(d.target.files);if(i.length===0)return;I.value=!0;const A=[];for(let V=0;V<i.length;V++){k.value=`${V+1} из ${i.length}`;const M=new FormData;M.append("image",i[V]),M.append("type","product");try{const E=await P.post("/admin/images",M,{headers:{"Content-Type":"multipart/form-data"}}),D=E.data.url||E.data.path;D&&(C.value.unshift({url:D,filename:i[V].name}),A.push(D))}catch(E){console.error(`Ошибка загрузки файла ${i[V].name}:`,E),alert(`Ошибка загрузки файла ${i[V].name}`)}}g.value.push(...A),I.value=!1,k.value="",d.target.value=""};return B(y,d=>{d&&(q(),g.value=[])}),(d,i)=>(r(),a("div",pe,[v.value.length>0?(r(),a("div",fe,[(r(!0),a(N,null,T(v.value,(A,V)=>(r(),a("div",{key:V,class:"relative group"},[e("img",{src:A,class:"w-full h-32 object-cover rounded border-2 border-gray-600"},null,8,xe),e("div",ve,[V>0?(r(),a("button",{key:0,onClick:M=>O(V),type:"button",class:"p-1 bg-white text-black rounded hover:bg-gray-200",title:"Переместить влево"}," ← ",8,he)):b("",!0),e("button",{onClick:M=>S(V),type:"button",class:"p-1 bg-red-600 text-white rounded hover:bg-red-700",title:"Удалить"}," × ",8,_e),V<v.value.length-1?(r(),a("button",{key:1,onClick:M=>L(V),type:"button",class:"p-1 bg-white text-black rounded hover:bg-gray-200",title:"Переместить вправо"}," → ",8,we)):b("",!0)])]))),128))])):(r(),a("p",ke," Изображения не добавлены ")),e("button",{onClick:i[0]||(i[0]=A=>y.value=!0),type:"button",class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"}," + Добавить изображения "),y.value?(r(),a("div",{key:2,class:"fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4",onClick:i[1]||(i[1]=Z(A=>y.value=!1,["self"]))},[e("div",Ve,[i[4]||(i[4]=e("h3",{class:"text-xl text-white mb-4"},"Добавление изображений в галерею",-1)),e("div",Ce,[i[2]||(i[2]=e("label",{class:"block text-gray-400 mb-2"},"Загрузить новые изображения",-1)),e("input",{type:"file",onChange:R,accept:"image/*",multiple:"",class:"text-white",disabled:I.value},null,40,Ae),I.value?(r(),a("p",Ue,"Загрузка "+m(k.value)+"...",1)):b("",!0)]),e("div",je,[i[3]||(i[3]=e("p",{class:"text-gray-400 mb-2"},"Выберите изображения (можно выбрать несколько):",-1)),e("div",Ie,[(r(!0),a(N,null,T(C.value,A=>(r(),a("div",{key:A.url,onClick:V=>o(A.url),class:Y(["cursor-pointer group relative",{"ring-2 ring-blue-500":g.value.includes(A.url)}])},[e("img",{src:A.url,class:Y(["w-full h-32 object-cover rounded",{"opacity-75":g.value.includes(A.url)}])},null,10,Se),g.value.includes(A.url)?(r(),a("div",Pe," ✓ ")):b("",!0)],10,qe))),128))])]),e("div",Me,[e("button",{onClick:w,disabled:g.value.length===0,class:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50"}," Добавить выбранные ("+m(g.value.length)+") ",9,Ne),e("button",{onClick:h,class:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700"}," Отмена ")])])])):b("",!0)]))}},Le={name:"QuickAddModal",props:{type:{type:String,required:!0,validator:p=>["theme","category","attribute"].includes(p)}},emits:["close","added"],setup(p,{emit:t}){const f=j(!1),s=j(""),y=te({name:"",slug:""}),C=z(()=>!(!y.name||p.type==="category"&&!y.slug));return B(()=>y.name,k=>{p.type==="category"&&k&&(y.slug=k.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}),{loading:f,error:s,form:y,isValid:C,save:async()=>{var k,v,q,o,w,h;if(C.value){f.value=!0,s.value="";try{const S=`/admin/${p.type}s`,O=p.type==="category"?{name:y.name,slug:y.slug}:{name:y.name},L=await P.post(S,O),R=L.data[p.type]||L.data.data||{id:Date.now(),name:y.name,slug:y.slug};t("added",R,p.type)}catch(S){console.error("Ошибка создания:",S),s.value=((v=(k=S.response)==null?void 0:k.data)==null?void 0:v.message)||((h=(w=(o=(q=S.response)==null?void 0:q.data)==null?void 0:o.errors)==null?void 0:w.name)==null?void 0:h[0])||"Ошибка создания"}finally{f.value=!1}}},getEntityName:k=>({theme:"тему",category:"категорию",attribute:"атрибут"})[k]||k}}},Ee={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},Oe={class:"bg-gray-800 rounded-lg max-w-md w-full"},Re={class:"p-6"},Qe={class:"text-xl font-semibold mb-6 text-white"},De={class:"block text-sm font-medium mb-2 text-white"},Fe=["placeholder"],ze={key:0},Be={key:1,class:"text-gray-400 text-sm"},Ke={key:2,class:"text-gray-400 text-sm"},We={key:3,class:"text-gray-400 text-sm"},Je={key:4,class:"text-red-400 text-sm"},Ge={class:"flex justify-end space-x-3 pt-4"},He=["disabled"],Xe=["disabled"];function Ye(p,t,f,s,y,C){return r(),a("div",Ee,[e("div",Oe,[e("div",Re,[e("h3",Qe," Добавить "+m(s.getEntityName(f.type)),1),e("form",{onSubmit:t[4]||(t[4]=Z((...g)=>s.save&&s.save(...g),["prevent"])),class:"space-y-4"},[e("div",null,[e("label",De," Название "+m(s.getEntityName(f.type).toLowerCase())+" * ",1),_(e("input",{"onUpdate:modelValue":t[0]||(t[0]=g=>s.form.name=g),type:"text",required:"",class:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:border-blue-500 focus:outline-none",placeholder:`Введите название ${s.getEntityName(f.type).toLowerCase()}`,onKeyup:t[1]||(t[1]=ue((...g)=>s.save&&s.save(...g),["enter"]))},null,40,Fe),[[U,s.form.name]])]),f.type==="category"?(r(),a("div",ze,[t[5]||(t[5]=e("label",{class:"block text-sm font-medium mb-2 text-white"}," URL-адрес (slug) * ",-1)),_(e("input",{"onUpdate:modelValue":t[2]||(t[2]=g=>s.form.slug=g),type:"text",required:"",class:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:border-blue-500 focus:outline-none",placeholder:"url-slug"},null,512),[[U,s.form.slug]]),t[6]||(t[6]=e("p",{class:"text-gray-400 text-xs mt-1"}," Используется в URL. Только латиница, цифры и дефисы. ",-1))])):b("",!0),f.type==="theme"?(r(),a("div",Be,t[7]||(t[7]=[e("p",null,"Темы используются для стилистической группировки товаров (например: Минимализм, Готика, Винтаж).",-1)]))):b("",!0),f.type==="category"?(r(),a("div",Ke,t[8]||(t[8]=[e("p",null,"Категории определяют тип украшения (например: Кольца, Браслеты, Серьги).",-1)]))):b("",!0),f.type==="attribute"?(r(),a("div",We,t[9]||(t[9]=[e("p",null,"Атрибуты описывают материалы и камни (например: агат, серебро, золото).",-1)]))):b("",!0),s.error?(r(),a("div",Je,m(s.error),1)):b("",!0),e("div",Ge,[e("button",{type:"button",onClick:t[3]||(t[3]=g=>p.$emit("close")),class:"px-4 py-2 text-gray-400 hover:text-white transition-colors",disabled:s.loading}," Отмена ",8,He),e("button",{type:"submit",disabled:!s.isValid||s.loading,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white px-6 py-2 rounded-lg font-medium transition-colors"},m(s.loading?"Создание...":"Создать"),9,Xe)])],32)])])])}const Ze=ee(Le,[["render",Ye]]),$e={name:"ProductCreate",components:{MultiImagePicker:Te,QuickAddModal:Ze},setup(){const p=be(),t=ye(),f=j(!1),s=z(()=>p.params.id?"edit":"create"),y=j(!1),C=j("category"),g=j([]),I=j([]),k=j([]),v=j([]),q=j([]),o=te({name:"",slug:"",description:"",price:0,sku:"",stock_quantity:0,weight:0,use_matryoshka:!1,image_layers:{outer:"",inner:""},gallery_images:[],theme_id:"",category_ids:[],attribute_values:{},meta_title:"",meta_description:"",dimensions:{length:0,width:0,height:0}}),w=z(()=>o.name&&o.description&&o.price>0&&o.sku&&o.theme_id),h=async()=>{try{const l=await P.get("/admin/categories");g.value=l.data}catch(l){console.error("Ошибка загрузки категорий:",l)}},S=async()=>{try{const l=await P.get("/admin/themes");I.value=l.data}catch(l){console.error("Ошибка загрузки тем:",l)}},O=async()=>{try{const l=await P.get("/admin/attributes");k.value=l.data}catch(l){console.error("Ошибка загрузки атрибутов:",l)}},L=async()=>{try{const l=await P.get("/admin/categories/tree");v.value=l.data}catch(l){console.error("Ошибка загрузки дерева категорий:",l)}},R=async()=>{try{const c=(await P.get("/admin/attributes")).data,n=await Promise.all(c.map(async u=>{try{const x=await P.get(`/admin/attributes/${u.id}/values`);return{...u,values:x.data||[]}}catch{return{...u,values:[]}}}));n.value=n}catch(l){console.error("Ошибка загрузки атрибутов:",l)}},d=async()=>{var l;try{f.value=!0;const n=(await P.get(`/admin/products/${p.params.id}`)).data;if(Object.assign(o,{name:n.name,slug:n.slug,description:n.description,price:n.price,sku:n.sku||"",stock_quantity:n.stock_quantity||0,weight:n.weight||0,use_matryoshka:n.use_matryoshka,image_layers:n.image_layers||{outer:"",inner:""},gallery_images:n.gallery_images||[],theme_id:n.theme_id,category_ids:((l=n.categories)==null?void 0:l.map(u=>u.id))||[],meta_title:n.meta_title||"",meta_description:n.meta_description||"",dimensions:n.dimensions||{length:0,width:0,height:0}}),n.product_attributes){const u={};n.product_attributes.forEach(x=>{u[x.attribute_id]||(u[x.attribute_id]={valueIds:[],customValue:""}),x.attribute_value_id&&u[x.attribute_id].valueIds.push(x.attribute_value_id),x.custom_value&&(u[x.attribute_id].customValue=x.custom_value)}),o.attribute_values=u}}catch(c){console.error("Ошибка загрузки товара:",c),alert("Ошибка загрузки товара"),t.push("/admin")}finally{f.value=!1}},i=(l,c)=>{o.attribute_values[l]||(o.attribute_values[l]={valueIds:[],customValue:""});const n=o.attribute_values[l].valueIds,u=n.indexOf(c);u>-1?n.splice(u,1):n.push(c)},A=(l,c)=>{o.attribute_values[l]||(o.attribute_values[l]={valueIds:[],customValue:""}),o.attribute_values[l].customValue=c.trim()},V=(l,c)=>{var n,u;return((u=(n=o.attribute_values[l])==null?void 0:n.valueIds)==null?void 0:u.includes(c))||!1},M=()=>{const l="STJ",c=Date.now().toString().slice(-6),n=Math.random().toString(36).substring(2,5).toUpperCase();o.sku=`${l}-${c}-${n}`},E=()=>{o.name&&!o.meta_title&&(o.meta_title=`${o.name} - купить в интернет-магазине Стужа`),o.description&&!o.meta_description&&(o.meta_description=o.description.substring(0,150)+"...")},D=l=>new Intl.NumberFormat("ru-RU").format(l),se=l=>{const c=n=>{for(const u of n){if(u.id===l)return u.name;if(u.children){const x=c(u.children);if(x)return x}}return null};return c(v.value)||"Неизвестная категория"},oe=l=>{const c=I.value.find(n=>n.id===l);return c?c.name:"Неизвестная тема"},le=l=>{const c=q.value.find(n=>n.id===parseInt(l));return c?c.name:"Неизвестный атрибут"},re=(l,c)=>{const n=q.value.find(x=>x.id===parseInt(l));if(!n)return"";const u=[];return c.valueIds.forEach(x=>{const K=n.values.find(F=>F.id===x);K&&u.push(K.value)}),c.customValue&&u.push(`"${c.customValue}"`),u.join(", ")},ae=l=>{C.value=l,y.value=!0},ne=async l=>{y.value=!1,C.value==="category"?await Promise.all([h(),L()]):C.value==="theme"?await S():C.value==="attribute"&&await Promise.all([O(),R()]),alert(`${C.value} добавлен!`)},ie=async()=>{var l,c;try{f.value=!0;const n={...o,product_attributes:Object.entries(o.attribute_values).filter(([F,Q])=>Q.valueIds.length>0||Q.customValue).flatMap(([F,Q])=>{const W=[];return Q.valueIds.forEach(de=>{W.push({attribute_id:parseInt(F),attribute_value_id:de,custom_value:null})}),Q.customValue&&W.push({attribute_id:parseInt(F),attribute_value_id:null,custom_value:Q.customValue}),W})},u=s.value==="edit",x=u?`/admin/products/${p.params.id}`:"/admin/products";await P[u?"put":"post"](x,n),alert(u?"Товар обновлен!":"Товар создан!"),t.push("/admin")}catch(n){console.error("Ошибка сохранения товара:",n);const u=((c=(l=n.response)==null?void 0:l.data)==null?void 0:c.message)||"Ошибка сохранения";alert("Ошибка: "+u)}finally{f.value=!1}};return B(()=>o.name,()=>{E()}),B(()=>o.description,()=>{E()}),me(async()=>{await Promise.all([h(),S(),O(),L(),R()]),p.params.id?await d():M()}),{loading:f,mode:s,quickAddOpen:y,quickAddType:C,categories:g,themes:I,attributes:k,categoryTree:v,attributesWithValues:q,form:o,isFormValid:w,toggleAttributeValue:i,addCustomAttributeValue:A,isAttributeValueSelected:V,generateSKU:M,formatPrice:D,getCategoryName:se,getThemeName:oe,getAttributeName:le,getAttributeDisplayValues:re,showQuickAdd:ae,onQuickAdded:ne,saveProduct:ie}}},et={class:"min-h-screen bg-gray-900 p-6"},tt={class:"max-w-7xl mx-auto"},st={class:"flex justify-between items-center mb-8"},ot={class:"text-3xl font-bold text-white"},lt={class:"lg:col-span-2 space-y-8"},rt={class:"bg-gray-800 rounded-lg p-6"},at={class:"space-y-6"},nt={class:"grid grid-cols-2 gap-4"},it={class:"flex space-x-2"},dt={class:"grid grid-cols-2 gap-4"},ut={class:"bg-gray-800 rounded-lg p-6"},mt={class:"space-y-6"},ct={class:"flex items-center justify-between mb-3"},gt=["value"],bt={class:"flex items-center justify-between mb-3"},yt={class:"max-h-60 overflow-y-auto bg-gray-700 border border-gray-600 rounded-lg p-3"},pt={class:"flex items-center mb-2"},ft=["value"],xt={class:"text-white font-medium"},vt={class:"ml-2 bg-gray-600 text-gray-300 px-2 py-1 rounded text-xs"},ht={key:0,class:"ml-6 space-y-1"},_t=["value"],wt={class:"text-gray-300"},kt={class:"ml-2 bg-gray-600 text-gray-300 px-2 py-1 rounded text-xs"},Vt={class:"flex items-center justify-between mb-3"},Ct={class:"space-y-4"},At={class:"flex items-center justify-between mb-3"},Ut={class:"text-white font-medium"},jt={key:0,class:"ml-2 bg-purple-600 text-white px-2 py-1 rounded text-xs"},It={class:"text-gray-400 text-sm"},qt={key:0,class:"mb-3"},St={class:"flex flex-wrap gap-2"},Pt=["checked","onChange"],Mt={class:"text-white text-sm"},Nt={key:0,class:"ml-2 text-red-400 text-xs"},Tt=["value","onInput","placeholder"],Lt={class:"bg-gray-800 rounded-lg p-6"},Et={class:"space-y-4"},Ot={class:"flex items-center"},Rt={key:0,class:"space-y-4"},Qt={key:0,class:"border border-gray-600 rounded-lg p-4"},Dt={class:"flex space-x-4"},Ft={key:0,class:"text-center"},zt=["src"],Bt={key:1,class:"text-center"},Kt=["src"],Wt={class:"bg-gray-800 rounded-lg p-6"},Jt={class:"bg-gray-800 rounded-lg p-6"},Gt={class:"space-y-4"},Ht={class:"grid grid-cols-3 gap-3"},Xt={class:"bg-gray-800 rounded-lg p-6"},Yt={class:"space-y-4"},Zt={class:"text-gray-400 text-xs mt-1"},$t={class:"text-gray-400 text-xs mt-1"},es={class:"bg-gray-800 rounded-lg p-6 sticky top-6"},ts={class:"bg-gray-700 rounded-lg p-4"},ss={key:0,class:"mb-4"},os=["src","alt"],ls={class:"text-xl font-bold text-white mb-2"},rs={class:"text-gray-300 text-sm mb-3"},as={class:"grid grid-cols-2 gap-4 mb-4 text-sm"},ns={class:"text-white ml-2"},is={class:"text-white ml-2"},ds={key:0},us={class:"text-white ml-2"},ms={key:1},cs={class:"text-white ml-2"},gs={key:1,class:"mb-3"},bs={class:"flex flex-wrap gap-1 mt-1"},ys={key:2,class:"mb-3"},ps={class:"space-y-1 mt-1"},fs={class:"text-white font-medium"},xs={class:"text-gray-300 ml-2"},vs={class:"flex items-center justify-between"},hs={class:"text-2xl font-bold text-red-600"},_s={class:"flex space-x-2"},ws={key:0,class:"bg-purple-600 text-white px-3 py-1 rounded text-sm"},ks={class:"bg-gray-600 text-gray-300 px-3 py-1 rounded text-sm"},Vs={class:"mt-6 space-y-3"},Cs=["disabled"];function As(p,t,f,s,y,C){var v,q;const g=J("router-link"),I=J("MultiImagePicker"),k=J("QuickAddModal");return r(),a("div",et,[e("div",tt,[e("div",st,[e("div",null,[e("h1",ot,m(s.mode==="edit"?"Редактировать товар":"Создать новый товар"),1),t[24]||(t[24]=e("p",{class:"text-gray-400 mt-1"},"Заполните информацию о товаре",-1))]),G(g,{to:"/admin",class:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors"},{default:$(()=>t[25]||(t[25]=[H(" ← Назад к админке ")])),_:1,__:[25]})]),e("form",{onSubmit:t[22]||(t[22]=Z((...o)=>s.saveProduct&&s.saveProduct(...o),["prevent"])),class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},[e("div",lt,[e("div",rt,[t[32]||(t[32]=e("h2",{class:"text-xl font-semibold text-white mb-4"},"Основная информация",-1)),e("div",at,[e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-white mb-2"}," Название товара * ",-1)),_(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>s.form.name=o),type:"text",required:"",class:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:border-blue-500 focus:outline-none",placeholder:"Например: Кольцо с агатом"},null,512),[[U,s.form.name]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-white mb-2"}," Описание * ",-1)),_(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=o=>s.form.description=o),required:"",rows:"4",class:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:border-blue-500 focus:outline-none",placeholder:"Подробное описание товара..."},null,512),[[U,s.form.description]])]),e("div",nt,[e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-white mb-2"}," Цена (рубли) * ",-1)),_(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>s.form.price=o),type:"number",required:"",min:"0",step:"0.01",class:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:border-blue-500 focus:outline-none",placeholder:"2500.00"},null,512),[[U,s.form.price,void 0,{number:!0}]])]),e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-white mb-2"}," Артикул товара * ",-1)),e("div",it,[_(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>s.form.sku=o),type:"text",required:"",class:"flex-1 bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:border-blue-500 focus:outline-none",placeholder:"STJ-123456-ABC"},null,512),[[U,s.form.sku]]),e("button",{type:"button",onClick:t[4]||(t[4]=o=>s.generateSKU()),class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition-colors"}," Генерировать ")])])]),e("div",dt,[e("div",null,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium text-white mb-2"}," Количество на складе ",-1)),_(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>s.form.stock_quantity=o),type:"number",min:"0",class:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:border-blue-500 focus:outline-none",placeholder:"0"},null,512),[[U,s.form.stock_quantity,void 0,{number:!0}]])]),e("div",null,[t[31]||(t[31]=e("label",{class:"block text-sm font-medium text-white mb-2"}," Вес (граммы) ",-1)),_(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>s.form.weight=o),type:"number",min:"0",step:"0.1",class:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:border-blue-500 focus:outline-none",placeholder:"0.0"},null,512),[[U,s.form.weight,void 0,{number:!0}]])])])])]),e("div",ut,[t[39]||(t[39]=e("h2",{class:"text-xl font-semibold text-white mb-4"},"Категории и свойства",-1)),e("div",mt,[e("div",null,[e("div",ct,[t[33]||(t[33]=e("label",{class:"block text-sm font-medium text-white"}," Тема * ",-1)),e("button",{type:"button",onClick:t[7]||(t[7]=o=>s.showQuickAdd("theme")),class:"text-blue-400 hover:text-blue-300 text-sm"}," + Добавить тему ")]),_(e("select",{"onUpdate:modelValue":t[8]||(t[8]=o=>s.form.theme_id=o),required:"",class:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-blue-500 focus:outline-none"},[t[34]||(t[34]=e("option",{value:""},"Выберите тему",-1)),(r(!0),a(N,null,T(s.themes,o=>(r(),a("option",{key:o.id,value:o.id},m(o.name),9,gt))),128))],512),[[ce,s.form.theme_id]])]),e("div",null,[e("div",bt,[t[35]||(t[35]=e("label",{class:"block text-sm font-medium text-white"}," Категории и подкатегории * ",-1)),e("button",{type:"button",onClick:t[9]||(t[9]=o=>s.showQuickAdd("category")),class:"text-blue-400 hover:text-blue-300 text-sm"}," + Добавить категорию ")]),e("div",yt,[(r(!0),a(N,null,T(s.categoryTree,o=>(r(),a("div",{key:o.id,class:"mb-3"},[e("label",pt,[_(e("input",{"onUpdate:modelValue":t[10]||(t[10]=w=>s.form.category_ids=w),value:o.id,type:"checkbox",class:"mr-3 rounded border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500"},null,8,ft),[[X,s.form.category_ids]]),e("span",xt,m(o.name),1),e("span",vt,m(o.products_count||0)+" товаров ",1)]),o.children&&o.children.length?(r(),a("div",ht,[(r(!0),a(N,null,T(o.children,w=>(r(),a("label",{key:w.id,class:"flex items-center"},[_(e("input",{"onUpdate:modelValue":t[11]||(t[11]=h=>s.form.category_ids=h),value:w.id,type:"checkbox",class:"mr-3 rounded border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500"},null,8,_t),[[X,s.form.category_ids]]),e("span",wt,"→ "+m(w.name),1),e("span",kt,m(w.products_count||0)+" товаров ",1)]))),128))])):b("",!0)]))),128))])]),e("div",null,[e("div",Vt,[t[36]||(t[36]=e("label",{class:"block text-sm font-medium text-white"}," Атрибуты (камни, металлы, размеры) ",-1)),e("button",{type:"button",onClick:t[12]||(t[12]=o=>s.showQuickAdd("attribute")),class:"text-blue-400 hover:text-blue-300 text-sm"}," + Добавить атрибут ")]),e("div",Ct,[(r(!0),a(N,null,T(s.attributesWithValues,o=>{var w;return r(),a("div",{key:o.id,class:"bg-gray-700 border border-gray-600 rounded-lg p-4"},[e("div",At,[e("h4",Ut,[H(m(o.name)+" ",1),o.is_stone?(r(),a("span",jt," Камень ")):b("",!0)]),e("span",It,m(o.values.length)+" значений ",1)]),o.values.length?(r(),a("div",qt,[t[37]||(t[37]=e("p",{class:"text-gray-300 text-sm mb-2"},"Выберите подходящие значения:",-1)),e("div",St,[(r(!0),a(N,null,T(o.values,h=>(r(),a("label",{key:h.id,class:Y(["flex items-center bg-gray-600 rounded px-3 py-2 cursor-pointer hover:bg-gray-500 transition-colors",{"bg-blue-600 hover:bg-blue-500":s.isAttributeValueSelected(o.id,h.id)}])},[e("input",{type:"checkbox",checked:s.isAttributeValueSelected(o.id,h.id),onChange:S=>s.toggleAttributeValue(o.id,h.id),class:"sr-only"},null,40,Pt),e("span",Mt,m(h.value),1),h.is_active?b("",!0):(r(),a("span",Nt,"(неакт.)"))],2))),128))])])):b("",!0),e("div",null,[t[38]||(t[38]=e("p",{class:"text-gray-300 text-sm mb-2"},"Или введите свое значение:",-1)),e("input",{value:((w=s.form.attribute_values[o.id])==null?void 0:w.customValue)||"",onInput:h=>s.addCustomAttributeValue(o.id,h.target.value),type:"text",class:"w-full bg-gray-600 border border-gray-500 rounded px-3 py-2 text-white text-sm",placeholder:`Например: для '${o.name}' - новое значение`},null,40,Tt)])])}),128))])])])]),e("div",Lt,[t[46]||(t[46]=e("h2",{class:"text-xl font-semibold text-white mb-4"},"Эффект матрёшки",-1)),e("div",Et,[e("label",Ot,[_(e("input",{"onUpdate:modelValue":t[13]||(t[13]=o=>s.form.use_matryoshka=o),type:"checkbox",class:"mr-3 rounded border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500"},null,512),[[X,s.form.use_matryoshka]]),t[40]||(t[40]=e("span",{class:"text-white font-medium"},"Использовать эффект матрёшки",-1))]),s.form.use_matryoshka?(r(),a("div",Rt,[e("div",null,[t[41]||(t[41]=e("label",{class:"block text-sm font-medium text-white mb-2"}," Внешний слой (URL изображения) ",-1)),_(e("input",{"onUpdate:modelValue":t[14]||(t[14]=o=>s.form.image_layers.outer=o),type:"url",class:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:border-blue-500 focus:outline-none",placeholder:"URL внешнего слоя"},null,512),[[U,s.form.image_layers.outer]])]),e("div",null,[t[42]||(t[42]=e("label",{class:"block text-sm font-medium text-white mb-2"}," Внутренний слой (URL изображения) ",-1)),_(e("input",{"onUpdate:modelValue":t[15]||(t[15]=o=>s.form.image_layers.inner=o),type:"url",class:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:border-blue-500 focus:outline-none",placeholder:"URL внутреннего слоя"},null,512),[[U,s.form.image_layers.inner]])]),s.form.image_layers.outer||s.form.image_layers.inner?(r(),a("div",Qt,[t[45]||(t[45]=e("p",{class:"text-white text-sm mb-2"},"Предпросмотр матрёшки:",-1)),e("div",Dt,[s.form.image_layers.outer?(r(),a("div",Ft,[e("img",{src:s.form.image_layers.outer,class:"w-24 h-24 object-cover rounded mb-2"},null,8,zt),t[43]||(t[43]=e("p",{class:"text-gray-400 text-xs"},"Внешний слой",-1))])):b("",!0),s.form.image_layers.inner?(r(),a("div",Bt,[e("img",{src:s.form.image_layers.inner,class:"w-24 h-24 object-cover rounded mb-2"},null,8,Kt),t[44]||(t[44]=e("p",{class:"text-gray-400 text-xs"},"Внутренний слой",-1))])):b("",!0)])])):b("",!0)])):b("",!0)])]),e("div",Wt,[t[47]||(t[47]=e("h2",{class:"text-xl font-semibold text-white mb-4"},"Галерея изображений",-1)),G(I,{modelValue:s.form.gallery_images,"onUpdate:modelValue":t[16]||(t[16]=o=>s.form.gallery_images=o)},null,8,["modelValue"])]),e("div",Jt,[t[52]||(t[52]=e("h2",{class:"text-xl font-semibold text-white mb-4"},"Физические характеристики",-1)),e("div",Gt,[e("div",null,[t[51]||(t[51]=e("label",{class:"block text-sm font-medium text-white mb-2"}," Размеры (см) ",-1)),e("div",Ht,[e("div",null,[_(e("input",{"onUpdate:modelValue":t[17]||(t[17]=o=>s.form.dimensions.length=o),type:"number",min:"0",step:"0.1",class:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white text-sm",placeholder:"Длина"},null,512),[[U,s.form.dimensions.length,void 0,{number:!0}]]),t[48]||(t[48]=e("p",{class:"text-gray-400 text-xs mt-1"},"Длина",-1))]),e("div",null,[_(e("input",{"onUpdate:modelValue":t[18]||(t[18]=o=>s.form.dimensions.width=o),type:"number",min:"0",step:"0.1",class:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white text-sm",placeholder:"Ширина"},null,512),[[U,s.form.dimensions.width,void 0,{number:!0}]]),t[49]||(t[49]=e("p",{class:"text-gray-400 text-xs mt-1"},"Ширина",-1))]),e("div",null,[_(e("input",{"onUpdate:modelValue":t[19]||(t[19]=o=>s.form.dimensions.height=o),type:"number",min:"0",step:"0.1",class:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white text-sm",placeholder:"Высота"},null,512),[[U,s.form.dimensions.height,void 0,{number:!0}]]),t[50]||(t[50]=e("p",{class:"text-gray-400 text-xs mt-1"},"Высота",-1))])])])])]),e("div",Xt,[t[55]||(t[55]=e("h2",{class:"text-xl font-semibold text-white mb-4"},"SEO настройки",-1)),e("div",Yt,[e("div",null,[t[53]||(t[53]=e("label",{class:"block text-sm font-medium text-white mb-2"}," SEO заголовок (meta title) ",-1)),_(e("input",{"onUpdate:modelValue":t[20]||(t[20]=o=>s.form.meta_title=o),type:"text",maxlength:"60",class:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:border-blue-500 focus:outline-none",placeholder:"Автоматически генерируется из названия"},null,512),[[U,s.form.meta_title]]),e("p",Zt,m(((v=s.form.meta_title)==null?void 0:v.length)||0)+"/60 символов ",1)]),e("div",null,[t[54]||(t[54]=e("label",{class:"block text-sm font-medium text-white mb-2"}," Мета описание (meta description) ",-1)),_(e("textarea",{"onUpdate:modelValue":t[21]||(t[21]=o=>s.form.meta_description=o),rows:"3",maxlength:"160",class:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:border-blue-500 focus:outline-none",placeholder:"Автоматически генерируется из описания"},null,512),[[U,s.form.meta_description]]),e("p",$t,m(((q=s.form.meta_description)==null?void 0:q.length)||0)+"/160 символов ",1)])])])]),e("div",null,[e("div",es,[t[63]||(t[63]=e("h2",{class:"text-xl font-semibold text-white mb-4"},"Предварительный просмотр",-1)),e("div",ts,[s.form.gallery_images[0]?(r(),a("div",ss,[e("img",{src:s.form.gallery_images[0],alt:s.form.name,class:"w-full h-48 object-cover rounded"},null,8,os)])):b("",!0),e("h3",ls,m(s.form.name||"Название товара"),1),e("p",rs,m(s.form.description||"Описание товара"),1),e("div",as,[e("div",null,[t[56]||(t[56]=e("span",{class:"text-gray-400"},"Артикул:",-1)),e("span",ns,m(s.form.sku||"Не указан"),1)]),e("div",null,[t[57]||(t[57]=e("span",{class:"text-gray-400"},"В наличии:",-1)),e("span",is,m(s.form.stock_quantity||0)+" шт.",1)]),s.form.weight?(r(),a("div",ds,[t[58]||(t[58]=e("span",{class:"text-gray-400"},"Вес:",-1)),e("span",us,m(s.form.weight)+" г",1)])):b("",!0),s.form.dimensions.length||s.form.dimensions.width||s.form.dimensions.height?(r(),a("div",ms,[t[59]||(t[59]=e("span",{class:"text-gray-400"},"Размеры:",-1)),e("span",cs,m(s.form.dimensions.length)+"×"+m(s.form.dimensions.width)+"×"+m(s.form.dimensions.height)+" см ",1)])):b("",!0)]),s.form.category_ids.length?(r(),a("div",gs,[t[60]||(t[60]=e("span",{class:"text-gray-400 text-sm"},"Категории:",-1)),e("div",bs,[(r(!0),a(N,null,T(s.form.category_ids,o=>(r(),a("span",{key:o,class:"bg-blue-600 text-white px-2 py-1 rounded text-xs"},m(s.getCategoryName(o)),1))),128))])])):b("",!0),Object.keys(s.form.attribute_values).length?(r(),a("div",ys,[t[61]||(t[61]=e("span",{class:"text-gray-400 text-sm"},"Атрибуты:",-1)),e("div",ps,[p.data.valueIds.length||p.data.customValue?(r(!0),a(N,{key:0},T(Object.entries(s.form.attribute_values),([o,w])=>(r(),a("div",{key:o,class:"text-xs"},[e("span",fs,m(s.getAttributeName(o))+":",1),e("span",xs,m(s.getAttributeDisplayValues(o,w)),1)]))),128)):b("",!0)])])):b("",!0),e("div",vs,[e("span",hs,m(s.form.price?s.formatPrice(s.form.price):"0")+" ₽ ",1),e("div",_s,[s.form.use_matryoshka?(r(),a("span",ws," Матрёшка ")):b("",!0),e("span",ks,m(s.form.theme_id?s.getThemeName(s.form.theme_id):"Без темы"),1)])])]),e("div",Vs,[e("button",{type:"submit",disabled:s.loading||!s.isFormValid,class:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white py-3 rounded-lg font-medium transition-colors"},m(s.loading?"Сохранение...":s.mode==="edit"?"Обновить товар":"Создать товар"),9,Cs),G(g,{to:"/admin",class:"block w-full bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg font-medium text-center transition-colors"},{default:$(()=>t[62]||(t[62]=[H(" Отмена ")])),_:1,__:[62]})])])])],32)]),s.quickAddOpen?(r(),ge(k,{key:0,type:s.quickAddType,onClose:t[23]||(t[23]=o=>s.quickAddOpen=!1),onAdded:s.onQuickAdded},null,8,["type","onAdded"])):b("",!0)])}const js=ee($e,[["render",As]]);export{js as default};
